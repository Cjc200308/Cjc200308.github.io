<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>羽之国原初之星计算器</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    
    <!-- 配置Tailwind自定义颜色和字体 -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#4F46E5', // 主色调：深紫色
                        secondary: '#10B981', // 辅助色：绿色
                        accent: '#F59E0B', // 强调色：橙色
                        dark: '#1E293B',
                        light: '#F8FAFC',
                        danger: '#EF4444' // 错误提示色：红色
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    
    <style type="text/tailwindcss">
        @layer utilities {
            .card-shadow {
                box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.05), 0 8px 10px -6px rgba(0, 0, 0, 0.02);
            }
            .input-focus {
                @apply focus:ring-2 focus:ring-primary/50 focus:border-primary focus:outline-none;
            }
            .section-transition {
                transition: all 0.3s ease;
            }
            .error-shake {
                animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both;
            }
            @keyframes shake {
                10%, 90% { transform: translateX(-1px); }
                20%, 80% { transform: translateX(2px); }
                30%, 50%, 70% { transform: translateX(-3px); }
                40%, 60% { transform: translateX(3px); }
            }
            .placeholder-hint::placeholder {
                opacity: 0.7;
            }
            .reward-item {
                @apply flex items-center justify-between p-3 rounded-lg transition-all;
            }
            .reward-unlocked {
                @apply bg-secondary/10 border border-secondary/30;
            }
            .reward-locked {
                @apply bg-gray-100 border border-gray-200 text-gray-400;
            }
            .reward-highlight {
                @apply bg-accent/10 border border-accent/30 scale-[1.02] font-medium;
            }
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen font-sans text-dark">

    <main class="container mx-auto px-4 py-8">
        <!-- 结果展示区 -->
        <div class="bg-gradient-to-r from-primary to-primary/80 rounded-2xl p-6 md:p-8 mb-8 text-white shadow-lg">
            <h2 class="text-xl md:text-2xl font-semibold mb-2">总原初之星数量</h2>
            <div class="flex items-end">
                <span id="totalStarsValue" class="text-4xl md:text-5xl font-bold mr-3">65</span>
                <span class="text-white/80 mb-1">个</span>
            </div>
            <div class="grid md:grid-cols-2 gap-4 mt-4 text-sm text-white/80">
                <div>
                    <p>本赛季原初之星: <span id="currentSeasonStars" class="font-medium">65</span> 个</p>
                </div>
                <div>
                    <p>上赛季原初之星: <span id="lastSeasonStarsDisplay" class="font-medium">0</span> 个</p>
                </div>
            </div>
        </div>

        <!-- 属性奖励展示区 -->
        <section class="bg-white rounded-xl p-6 card-shadow section-transition hover:shadow-lg mb-8">
            <div class="flex items-center mb-4">
                <div class="w-10 h-10 rounded-full bg-accent/10 flex items-center justify-center mr-3">
                    <i class="fa fa-trophy text-accent"></i>
                </div>
                <h2 class="text-xl font-bold">属性奖励</h2>
            </div>
            
            <div class="mb-4">
                <div class="flex justify-between items-center text-sm text-gray-500 mb-2">
                    <span>当前进度</span>
                    <span id="nextRewardProgress">距离下一个奖励: <span id="starsUntilNext">1175</span> 个</span>
                </div>
                <div class="w-full bg-gray-200 rounded-full h-2.5">
                    <div id="rewardProgressBar" class="bg-accent h-2.5 rounded-full" style="width: 5%"></div>
                </div>
            </div>
            
            <div id="rewardsContainer" class="space-y-2 max-h-96 overflow-y-auto pr-2">
                <!-- 奖励列表将通过JS动态生成 -->
            </div>
        </section>

        <!-- 上赛季数据输入区 -->
        <section class="bg-white rounded-xl p-6 card-shadow section-transition hover:shadow-lg mb-8">
            <div class="flex items-center mb-4">
                <div class="w-10 h-10 rounded-full bg-primary/10 flex items-center justify-center mr-3">
                    <i class="fa fa-history text-primary"></i>
                </div>
                <h2 class="text-xl font-bold">上赛季数据</h2>
            </div>
            <div class="grid md:grid-cols-2 gap-4">
                <div class="space-y-2">
                    <label for="lastSeasonStars" class="block text-sm font-medium text-gray-700">上赛季获得的原初之星数量</label>
                    <div class="relative">
                        <input type="number" id="lastSeasonStars" name="lastSeasonStars" 
                            value="0" min="0" 
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg input-focus transition-all"
                            placeholder="请输入上赛季获得的原初之星数量">
                        <div class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-400">
                            <i class="fa fa-star"></i>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- 计算器表单 -->
        <form id="calculatorForm" class="space-y-8">
            <!-- 人物等级 -->
            <section class="bg-white rounded-xl p-6 card-shadow section-transition hover:shadow-lg">
                <div class="flex items-center mb-4">
                    <div class="w-10 h-10 rounded-full bg-primary/10 flex items-center justify-center mr-3">
                        <i class="fa fa-user text-primary"></i>
                    </div>
                    <h2 class="text-xl font-bold">人物等级</h2>
                </div>
                <div class="grid md:grid-cols-2 gap-4">
                    <div class="space-y-2">
                        <label for="characterLevel" class="block text-sm font-medium text-gray-700">人物等级</label>
                        <div class="relative">
                            <input type="number" id="characterLevel" name="characterLevel" 
                                min="160" 
                                class="w-full px-4 py-2 border border-gray-300 rounded-lg input-focus transition-all placeholder-hint"
                                data-base="160" data-increment="100"
                                placeholder="请输入人物等级">
                            <div class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-400">
                                <i class="fa fa-level-up"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- 技能等级 -->
            <section class="bg-white rounded-xl p-6 card-shadow section-transition hover:shadow-lg">
                <div class="flex items-center mb-4">
                    <div class="w-10 h-10 rounded-full bg-primary/10 flex items-center justify-center mr-3">
                        <i class="fa fa-magic text-primary"></i>
                    </div>
                    <h2 class="text-xl font-bold">技能等级</h2>
                </div>
                <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-4">
                    <!-- 技能1-8 -->
                    <div class="space-y-2">
                        <label for="skill1" class="block text-sm font-medium text-gray-700">技能 1</label>
                        <input type="number" id="skill1" name="skill1" 
                            min="160" 
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg input-focus transition-all placeholder-hint"
                            data-base="160" data-increment="5"
                            placeholder="请输入技能等级">
                    </div>
                    <div class="space-y-2">
                        <label for="skill2" class="block text-sm font-medium text-gray-700">技能 2</label>
                        <input type="number" id="skill2" name="skill2" 
                            min="160" 
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg input-focus transition-all placeholder-hint"
                            data-base="160" data-increment="5"
                            placeholder="请输入技能等级">
                    </div>
                    <div class="space-y-2">
                        <label for="skill3" class="block text-sm font-medium text-gray-700">技能 3</label>
                        <input type="number" id="skill3" name="skill3" 
                            min="160" 
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg input-focus transition-all placeholder-hint"
                            data-base="160" data-increment="5"
                            placeholder="请输入技能等级">
                    </div>
                    <div class="space-y-2">
                        <label for="skill4" class="block text-sm font-medium text-gray-700">技能 4</label>
                        <input type="number" id="skill4" name="skill4" 
                            min="160" 
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg input-focus transition-all placeholder-hint"
                            data-base="160" data-increment="5"
                            placeholder="请输入技能等级">
                    </div>
                    <div class="space-y-2">
                        <label for="skill5" class="block text-sm font-medium text-gray-700">技能 5</label>
                        <input type="number" id="skill5" name="skill5" 
                            min="160" 
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg input-focus transition-all placeholder-hint"
                            data-base="160" data-increment="5"
                            placeholder="请输入技能等级">
                    </div>
                    <div class="space-y-2">
                        <label for="skill6" class="block text-sm font-medium text-gray-700">技能 6</label>
                        <input type="number" id="skill6" name="skill6" 
                            min="160" 
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg input-focus transition-all placeholder-hint"
                            data-base="160" data-increment="5"
                            placeholder="请输入技能等级">
                    </div>
                    <div class="space-y-2">
                        <label for="skill7" class="block text-sm font-medium text-gray-700">技能 7</label>
                        <input type="number" id="skill7" name="skill7" 
                            min="160" 
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg input-focus transition-all placeholder-hint"
                            data-base="160" data-increment="5"
                            placeholder="请输入技能等级">
                    </div>
                    <div class="space-y-2">
                        <label for="skill8" class="block text-sm font-medium text-gray-700">技能 8</label>
                        <input type="number" id="skill8" name="skill8" 
                            min="160" 
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg input-focus transition-all placeholder-hint"
                            data-base="160" data-increment="5"
                            placeholder="请输入技能等级">
                    </div>
                </div>
            </section>

            <!-- 装备等级 -->
            <section class="bg-white rounded-xl p-6 card-shadow section-transition hover:shadow-lg">
                <div class="flex items-center mb-4">
                    <div class="w-10 h-10 rounded-full bg-primary/10 flex items-center justify-center mr-3">
                        <i class="fa fa-shield text-primary"></i>
                    </div>
                    <h2 class="text-xl font-bold">装备等级</h2>
                </div>
                <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-4">
                    <div class="space-y-2">
                        <label for="weapon" class="block text-sm font-medium text-gray-700">武器</label>
                        <input type="number" id="weapon" name="weapon" 
                            min="160" 
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg input-focus transition-all placeholder-hint"
                            data-base="160" data-increment="14"
                            placeholder="请输入装备等级">
                    </div>
                    <div class="space-y-2">
                        <label for="secondaryWeapon" class="block text-sm font-medium text-gray-700">副武器</label>
                        <input type="number" id="secondaryWeapon" name="secondaryWeapon" 
                            min="160" 
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg input-focus transition-all placeholder-hint"
                            data-base="160" data-increment="14"
                            placeholder="请输入装备等级">
                    </div>
                    <div class="space-y-2">
                        <label for="head" class="block text-sm font-medium text-gray-700">头部</label>
                        <input type="number" id="head" name="head" 
                            min="160" 
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg input-focus transition-all placeholder-hint"
                            data-base="160" data-increment="14"
                            placeholder="请输入装备等级">
                    </div>
                    <div class="space-y-2">
                        <label for="armor" class="block text-sm font-medium text-gray-700">铠甲</label>
                        <input type="number" id="armor" name="armor" 
                            min="160" 
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg input-focus transition-all placeholder-hint"
                            data-base="160" data-increment="14"
                            placeholder="请输入装备等级">
                    </div>
                    <div class="space-y-2">
                        <label for="shoes" class="block text-sm font-medium text-gray-700">鞋子</label>
                        <input type="number" id="shoes" name="shoes" 
                            min="160" 
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg input-focus transition-all placeholder-hint"
                            data-base="160" data-increment="14"
                            placeholder="请输入装备等级">
                    </div>
                </div>
            </section>

            <!-- 幻兽等级 -->
            <section class="bg-white rounded-xl p-6 card-shadow section-transition hover:shadow-lg">
                <div class="flex items-center mb-4">
                    <div class="w-10 h-10 rounded-full bg-primary/10 flex items-center justify-center mr-3">
                        <i class="fa fa-paw text-primary"></i>
                    </div>
                    <h2 class="text-xl font-bold">幻兽等级</h2>
                </div>
                <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-4">
                    <div class="space-y-2">
                        <label for="mainPet" class="block text-sm font-medium text-gray-700">主宠</label>
                        <input type="number" id="mainPet" name="mainPet" 
                            min="160" 
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg input-focus transition-all placeholder-hint"
                            data-base="160" data-increment="6"
                            placeholder="请输入幻兽等级">
                    </div>
                    <div class="space-y-2">
                        <label for="pet1" class="block text-sm font-medium text-gray-700">副宠 1</label>
                        <div class="relative">
                            <input type="number" id="pet1" name="pet1" 
                                min="160" 
                                class="w-full px-4 py-2 border border-gray-300 rounded-lg input-focus transition-all placeholder-hint"
                                data-base="160" data-increment="6" data-pet-type="secondary"
                                placeholder="请输入幻兽等级">
                            <div class="hidden absolute -bottom-6 left-0 text-xs text-danger pet-error">
                                <i class="fa fa-exclamation-circle mr-1"></i>副宠等级不能超过主宠
                            </div>
                        </div>
                    </div>
                    <div class="space-y-2">
                        <label for="pet2" class="block text-sm font-medium text-gray-700">副宠 2</label>
                        <div class="relative">
                            <input type="number" id="pet2" name="pet2" 
                                min="160" 
                                class="w-full px-4 py-2 border border-gray-300 rounded-lg input-focus transition-all placeholder-hint"
                                data-base="160" data-increment="6" data-pet-type="secondary"
                                placeholder="请输入幻兽等级">
                            <div class="hidden absolute -bottom-6 left-0 text-xs text-danger pet-error">
                                <i class="fa fa-exclamation-circle mr-1"></i>副宠等级不能超过主宠
                            </div>
                        </div>
                    </div>
                    <div class="space-y-2">
                        <label for="pet3" class="block text-sm font-medium text-gray-700">副宠 3</label>
                        <div class="relative">
                            <input type="number" id="pet3" name="pet3" 
                                min="160" 
                                class="w-full px-4 py-2 border border-gray-300 rounded-lg input-focus transition-all placeholder-hint"
                                data-base="160" data-increment="6" data-pet-type="secondary"
                                placeholder="请输入幻兽等级">
                            <div class="hidden absolute -bottom-6 left-0 text-xs text-danger pet-error">
                                <i class="fa fa-exclamation-circle mr-1"></i>副宠等级不能超过主宠
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- 遗物等级 -->
            <section class="bg-white rounded-xl p-6 card-shadow section-transition hover:shadow-lg">
                <div class="flex items-center mb-4">
                    <div class="w-10 h-10 rounded-full bg-primary/10 flex items-center justify-center mr-3">
                        <i class="fa fa-diamond text-primary"></i>
                    </div>
                    <h2 class="text-xl font-bold">遗物等级</h2>
                </div>
                <div class="grid md:grid-cols-2 gap-4">
                    <div class="space-y-2">
                        <label for="relicResonance" class="block text-sm font-medium text-gray-700">共鸣等级</label>
                        <div class="relative">
                            <input type="number" id="relicResonance" name="relicResonance" 
                                min="16" 
                                class="w-full px-4 py-2 border border-gray-300 rounded-lg input-focus transition-all placeholder-hint"
                                data-base="16" data-increment="520"
                                placeholder="请输入共鸣等级">
                            <div class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-400">
                                <i class="fa fa-sync"></i>
                            </div>
                        </div>
                    </div>
                    <div class="space-y-2">
                        <label for="relicExcess" class="block text-sm font-medium text-gray-700">超出共鸣等级的遗物数量</label>
                        <div class="relative">
                            <input type="number" id="relicExcess" name="relicExcess" 
                                value="0" min="0" 
                                class="w-full px-4 py-2 border border-gray-300 rounded-lg input-focus transition-all placeholder-hint"
                                data-base="0" data-increment="26"
                                placeholder="请输入遗物数量">
                            <div class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-400">
                                <i class="fa fa-plus-circle"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- 操作按钮 -->
            <div class="flex justify-center mt-6">
                <button type="reset" id="resetBtn" class="bg-gray-200 hover:bg-gray-300 text-gray-700 font-medium py-3 px-8 rounded-lg transition-all">
                    <i class="fa fa-refresh mr-2"></i>重置
                </button>
            </div>
        </form>
    </main>

    <script>
        // 原初之星对应的属性奖励数据
        const starRewards = [
	    { stars: 505, effect: "攻击+1%" },
            { stars: 530, effect: "副本掉落装备升华概率+3%" },
            { stars: 555, effect: "防御+1%" },
            { stars: 580, effect: "宝石获取+5%" },
            { stars: 630, effect: "生命+1%" },
            { stars: 605, effect: "副本评价奖励翻倍概率+2%" },
            { stars: 655, effect: "速度+1%" },
            { stars: 680, effect: "经验获取加成+2%" },
  	    { stars: 710, effect: "攻击+1%" },
            { stars: 740, effect: "副本掉落装备升华概率+3%" },
            { stars: 770, effect: "防御+1%" },
            { stars: 800, effect: "宝石获取+5%" },
            { stars: 830, effect: "生命+1%" },
            { stars: 860, effect: "副本评价奖励翻倍概率+2%" },
            { stars: 890, effect: "速度+1%" },
            { stars: 920, effect: "经验获取加成+2%" },
	    { stars: 955, effect: "攻击+1%" },
            { stars: 990, effect: "副本掉落装备升华概率+3%" },
            { stars: 1025, effect: "防御+1%" },
            { stars: 1060, effect: "宝石获取+5%" },
            { stars: 1095, effect: "生命+1%" },
            { stars: 1130, effect: "副本评价奖励翻倍概率+2%" },
            { stars: 1165, effect: "速度+1%" },
            { stars: 1200, effect: "经验获取加成+2%" },
            { stars: 1240, effect: "攻击+1%" },
            { stars: 1280, effect: "副本掉落装备升华概率+3%" },
            { stars: 1320, effect: "防御+1%" },
            { stars: 1360, effect: "宝石获取+5%" },
            { stars: 1400, effect: "生命+1%" },
            { stars: 1440, effect: "副本评价奖励翻倍概率+2%" },
            { stars: 1480, effect: "速度+1%" },
            { stars: 1520, effect: "经验获取加成+2%" },
            { stars: 1565, effect: "攻击+1%" },
            { stars: 1610, effect: "副本掉落装备升华概率+3%" },
            { stars: 1655, effect: "防御+1%" },
            { stars: 1700, effect: "宝石获取+5%" },
            { stars: 1745, effect: "生命+1%" },
            { stars: 1790, effect: "副本评价奖励翻倍概率+2%" },
            { stars: 1835, effect: "速度+1%" },
            { stars: 1880, effect: "经验获取加成+2%" },
            { stars: 1940, effect: "攻击+1%" },
            { stars: 2000, effect: "副本掉落装备升华概率+3%" },
            { stars: 2060, effect: "防御+1%" },
            { stars: 2120, effect: "宝石获取+5%" },
            { stars: 2180, effect: "生命+1%" },
            { stars: 2240, effect: "副本评价奖励翻倍概率+2%" },
            { stars: 2300, effect: "速度+1%" },
            { stars: 2360, effect: "经验获取加成+2%" },
            { stars: 2425, effect: "攻击+1%" },
            { stars: 2490, effect: "副本掉落装备升华概率+3%" },
            { stars: 2555, effect: "防御+1%" },
            { stars: 2620, effect: "宝石获取+5%" },
            { stars: 2685, effect: "生命+1%" },
            { stars: 2750, effect: "副本评价奖励翻倍概率+2%" },
            { stars: 2815, effect: "速度+1%" },
            { stars: 2880, effect: "经验获取加成+2%" },
            { stars: 2950, effect: "攻击+1%" },
            { stars: 3020, effect: "副本掉落装备升华概率+3%" },
            { stars: 3090, effect: "防御+1%" },
            { stars: 3160, effect: "宝石获取+5%" },
            { stars: 3230, effect: "生命+1%" },
            { stars: 3300, effect: "副本评价奖励翻倍概率+2%" },
            { stars: 3370, effect: "速度+1%" },
            { stars: 3440, effect: "经验获取加成+2%" },
            { stars: 3515, effect: "攻击+1%" },
            { stars: 3590, effect: "副本掉落装备升华概率+3%" },
            { stars: 3665, effect: "防御+1%" },
            { stars: 3740, effect: "宝石获取+5%" },
            { stars: 3815, effect: "生命+1%" },
            { stars: 3890, effect: "副本评价奖励翻倍概率+2%" },
            { stars: 3965, effect: "速度+1%" },
            { stars: 4040, effect: "经验获取加成+2%" },
            { stars: 4120, effect: "攻击+1%" },
            { stars: 4200, effect: "副本掉落装备升华概率+3%" },
            { stars: 4280, effect: "防御+1%" },
            { stars: 4360, effect: "宝石获取+5%" },
            { stars: 4440, effect: "生命+1%" },
            { stars: 4520, effect: "副本评价奖励翻倍概率+2%" },
            { stars: 4600, effect: "速度+1%" },
            { stars: 4680, effect: "经验获取加成+2%" },
            { stars: 4765, effect: "攻击+1%" },
            { stars: 4850, effect: "副本掉落装备升华概率+3%" },
            { stars: 4935, effect: "防御+1%" },
            { stars: 5020, effect: "宝石获取+5%" },
            { stars: 5105, effect: "生命+1%" },
            { stars: 5190, effect: "副本评价奖励翻倍概率+2%" },
            { stars: 5275, effect: "速度+1%" },
            { stars: 5360, effect: "经验获取加成+2%" }
        ];

        // 页面加载时初始化所有输入框
        document.addEventListener('DOMContentLoaded', function() {
            // 为所有需要隐藏初始值的输入框设置空值
            const inputsToClear = document.querySelectorAll('input[min="160"], input[min="16"]');
            inputsToClear.forEach(input => {
                input.value = '';
            });
            
            // 初始化计算
            calculateAllScores();
            // 初始化奖励列表
            updateRewardDisplay(65); // 默认值
        });

        // 副宠等级验证函数
        function validatePetLevels() {
            const mainPetInput = document.getElementById('mainPet');
            const mainPetLevel = parseInt(mainPetInput.value) || parseInt(mainPetInput.min);
            const secondaryPets = document.querySelectorAll('input[data-pet-type="secondary"]');
            let isValid = true;
            
            secondaryPets.forEach(pet => {
                const petLevel = parseInt(pet.value) || parseInt(pet.min);
                const errorElement = pet.nextElementSibling;
                
                // 隐藏之前的错误提示
                errorElement.classList.add('hidden');
                pet.classList.remove('border-danger', 'error-shake');
                
                // 验证等级
                if (petLevel > mainPetLevel) {
                    isValid = false;
                    // 显示错误提示
                    errorElement.classList.remove('hidden');
                    pet.classList.add('border-danger', 'error-shake');
                    // 自动调整为与主宠相同等级
                    setTimeout(() => {
                        pet.value = mainPetLevel;
                    }, 500);
                }
            });
            
            return isValid;
        }

        // 计算单个项目的评分
        function calculateItemScore(input) {
            const level = parseInt(input.value) || parseInt(input.min) || 0;
            const baseLevel = parseInt(input.dataset.base) || 0;
            const increment = parseInt(input.dataset.increment) || 0;
            
            // 等级不低于基础等级时才计算加分
            if (level >= baseLevel) {
                return (level - baseLevel) * increment;
            }
            return 0;
        }

        // 更新奖励展示 - 未解锁任何奖励时只显示接下来要解锁的10个奖励
        function updateRewardDisplay(totalStars) {
            const rewardsContainer = document.getElementById('rewardsContainer');
            rewardsContainer.innerHTML = '';
            
            // 找出已解锁的奖励和下一个奖励
            const unlockedRewards = starRewards.filter(reward => reward.stars <= totalStars);
            const nextReward = starRewards.find(reward => reward.stars > totalStars);
            
            // 计算进度
            const firstRewardStars = starRewards.length > 0 ? starRewards[0].stars : 0;
            const lastRewardStars = starRewards.length > 0 ? starRewards[starRewards.length - 1].stars : 0;
            
            let progressPercent = 0;
            let starsUntilNext = 0;
            
            if (nextReward) {
                starsUntilNext = nextReward.stars - totalStars;
                // 计算进度百分比
                if (lastRewardStars > firstRewardStars) {
                    progressPercent = Math.min(100, Math.max(0, (totalStars - firstRewardStars) / (lastRewardStars - firstRewardStars) * 100));
                }
            } else if (unlockedRewards.length > 0) {
                // 所有奖励都已解锁
                progressPercent = 100;
                starsUntilNext = 0;
            }
            
            // 更新进度条和文字
            document.getElementById('rewardProgressBar').style.width = `${progressPercent}%`;
            document.getElementById('starsUntilNext').textContent = starsUntilNext;
            
            // 显示奖励的逻辑
            const displayRewards = [];
            
            // 未解锁任何奖励时，只显示接下来要解锁的10个奖励
            if (unlockedRewards.length === 0 && starRewards.length > 0) {
                // 找到第一个需要解锁的奖励索引
                const firstUnlockedIndex = starRewards.findIndex(reward => reward.stars > totalStars);
                // 如果找到了下一个奖励，从那里开始取10个；否则从开头取10个
                const startIndex = firstUnlockedIndex !== -1 ? firstUnlockedIndex : 0;
                const initialRewards = starRewards.slice(startIndex, startIndex + 10);
                displayRewards.push(...initialRewards);
            } else {
                // 已经解锁了部分奖励的情况：显示最近解锁的5个和接下来的5个
                if (unlockedRewards.length > 0) {
                    // 从解锁的奖励中取最近的5个
                    const recentUnlocked = unlockedRewards.slice(-5);
                    displayRewards.push(...recentUnlocked);
                }
                
                // 添加接下来的5个待解锁奖励
                if (nextReward) {
                    const nextRewardsIndex = starRewards.indexOf(nextReward);
                    const upcomingRewards = starRewards.slice(nextRewardsIndex, nextRewardsIndex + 5);
                    
                    // 避免重复添加
                    upcomingRewards.forEach(reward => {
                        if (!displayRewards.some(r => r.stars === reward.stars)) {
                            displayRewards.push(reward);
                        }
                    });
                }
            }
            
            // 创建奖励项元素
            displayRewards.forEach(reward => {
                const isUnlocked = reward.stars <= totalStars;
                const isNext = nextReward && reward.stars === nextReward.stars;
                
                const rewardItem = document.createElement('div');
                rewardItem.className = `reward-item ${isUnlocked ? 'reward-unlocked' : 'reward-locked'} ${isNext ? 'reward-highlight' : ''}`;
                
                rewardItem.innerHTML = `
                    <div class="flex items-center">
                        <i class="fa ${isUnlocked ? 'fa-check-circle text-secondary' : 'fa-lock text-gray-400'} mr-2"></i>
                        <span>${reward.effect}</span>
                    </div>
                    <span class="text-sm font-medium">${reward.stars} 星</span>
                `;
                
                rewardsContainer.appendChild(rewardItem);
            });

            // 如果有下一个奖励，自动滚动到下一个奖励位置
            if (nextReward) {
                const nextRewardElement = rewardsContainer.querySelector('.reward-highlight');
                if (nextRewardElement) {
                    nextRewardElement.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                }
            }
        }

        // 计算所有评分并更新结果
        function calculateAllScores() {
            // 先验证副宠等级
            const isPetLevelsValid = validatePetLevels();
            if (!isPetLevelsValid) {
                // 如果副宠等级无效，短暂延迟后重新计算
                setTimeout(calculateAllScores, 600);
                return;
            }
            
            // 获取上赛季原初之星数量
            const lastSeasonStars = parseInt(document.getElementById('lastSeasonStars').value) || 0;
            document.getElementById('lastSeasonStarsDisplay').textContent = lastSeasonStars;
            
            // 人物评分
            const characterInput = document.getElementById('characterLevel');
            const characterScore = calculateItemScore(characterInput);
            
            // 技能评分
            let skillsTotal = 0;
            for (let i = 1; i <= 8; i++) {
                const skillInput = document.getElementById(`skill${i}`);
                skillsTotal += calculateItemScore(skillInput);
            }
            
            // 装备评分
            const equipmentInputs = ['weapon', 'secondaryWeapon', 'head', 'armor', 'shoes'];
            let equipmentTotal = 0;
            equipmentInputs.forEach(id => {
                const input = document.getElementById(id);
                equipmentTotal += calculateItemScore(input);
            });
            
            // 幻兽评分
            const petInputs = ['mainPet', 'pet1', 'pet2', 'pet3'];
            let petsTotal = 0;
            petInputs.forEach(id => {
                const input = document.getElementById(id);
                petsTotal += calculateItemScore(input);
            });
            
            // 遗物评分
            const resonanceInput = document.getElementById('relicResonance');
            const excessInput = document.getElementById('relicExcess');
            const resonanceScore = calculateItemScore(resonanceInput);
            const excessScore = calculateItemScore(excessInput);
            const relicsTotal = resonanceScore + excessScore;
            
            // 总评分和结果计算（使用Math.floor进行向下取整）
            const totalScore = characterScore + skillsTotal + equipmentTotal + petsTotal + relicsTotal;
            const currentSeasonStars = Math.floor(65 + totalScore / 13);
            const totalStars = currentSeasonStars + lastSeasonStars;
            
            // 更新显示
            document.getElementById('currentSeasonStars').textContent = currentSeasonStars;
            document.getElementById('totalStarsValue').textContent = totalStars;
            
            // 更新奖励展示
            updateRewardDisplay(totalStars);
            
            // 添加结果更新动画
            const resultElement = document.getElementById('totalStarsValue');
            resultElement.classList.add('scale-110', 'text-accent');
            setTimeout(() => {
                resultElement.classList.remove('scale-110', 'text-accent');
            }, 300);
        }
        
        // 为所有输入框添加输入事件监听，实现实时自动计算
        document.querySelectorAll('input[type="number"]').forEach(input => {
            input.addEventListener('input', calculateAllScores);
            // 添加失去焦点事件，确保数值不低于最小值
            input.addEventListener('blur', function() {
                const min = parseInt(this.min) || 0;
                // 如果输入为空或小于最小值，设置为最小值
                if (!this.value || parseInt(this.value) < min) {
                    this.value = min;
                    calculateAllScores();
                }
            });
        });
        
        // 为主宠等级添加额外监听，当主宠等级变化时验证副宠
        document.getElementById('mainPet').addEventListener('input', function() {
            const mainPetLevel = parseInt(this.value) || parseInt(this.min);
            const secondaryPets = document.querySelectorAll('input[data-pet-type="secondary"]');
            
            secondaryPets.forEach(pet => {
                const petLevel = parseInt(pet.value) || parseInt(pet.min);
                if (petLevel > mainPetLevel) {
                    pet.value = mainPetLevel;
                }
            });
            calculateAllScores();
        });
        
        // 重置按钮点击事件后重新计算
        document.getElementById('resetBtn').addEventListener('click', function() {
            setTimeout(() => {
                // 重置后清空输入框并确保不低于最小值
                const inputsToClear = document.querySelectorAll('input[min="160"], input[min="16"]');
                inputsToClear.forEach(input => {
                    input.value = '';
                });
                
                // 确保副宠等级不超过主宠
                const mainPetInput = document.getElementById('mainPet');
                const mainPetLevel = parseInt(mainPetInput.min);
                const secondaryPets = document.querySelectorAll('input[data-pet-type="secondary"]');
                
                secondaryPets.forEach(pet => {
                    pet.value = '';
                    // 清除错误状态
                    pet.classList.remove('border-danger');
                    const errorElement = pet.nextElementSibling;
                    errorElement.classList.add('hidden');
                });
                
                calculateAllScores();
            }, 100);
            
            // 按钮点击动画
            this.classList.add('scale-95');
            setTimeout(() => {
                this.classList.remove('scale-95');
            }, 200);
        });
    </script>
</body>
</html>
